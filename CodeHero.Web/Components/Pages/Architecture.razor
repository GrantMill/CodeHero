@page "/architecture"
@using CodeHero.Web.Services
@inject FileStore Store

<h3>Architecture</h3>

@if (selected is null)
{
    <ul>
        @foreach (var f in Store.List(StoreRoot.Architecture, ".md", ".dsl", ".txt"))
        {
            <li><a href="#" @onclick="() => Load(f)">@f</a></li>
        }
    </ul>
}
else
{
    <h5>@selected</h5>
    @if (selected.EndsWith(".md", StringComparison.OrdinalIgnoreCase))
    {
        <textarea class="form-control" style="height:45vh" @bind="text"></textarea>
        <div class="mt-2">
            <button class="btn btn-primary" @onclick="Save">Save</button>
            <button class="btn btn-secondary ms-2" @onclick="Back">Back</button>
        </div>
    }
    else
    {
        <pre>@text</pre>
        <div class="mt-2">
            <button class="btn btn-secondary" @onclick="Back">Back</button>
        </div>
    }
}

@code {
    string? selected;
    string? text;

    void Load(string f)
    {
        selected = f;
        text = Store.ReadText(StoreRoot.Architecture, f, ".md", ".dsl", ".txt");
    }

    void Save()
    {
        if (selected is not null && text is not null && selected.EndsWith(".md", StringComparison.OrdinalIgnoreCase))
        {
            Store.WriteText(StoreRoot.Architecture, selected, text, ".md");
        }
    }

    void Back()
    {
        selected = null; text = null;
    }
}
