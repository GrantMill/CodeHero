name: Provision Azure Cognitive Search and Set Secrets

on:
 workflow_dispatch:

jobs:
 provision-search:
 runs-on: ubuntu-latest
 permissions:
 contents: read
 id-token: write

 steps:
 - name: Checkout
 uses: actions/checkout@v4

 - name: Login to Azure
 uses: azure/login@v2
 with:
 client-id: ${{ secrets.AZURE_CLIENT_ID }}
 tenant-id: ${{ secrets.AZURE_TENANT_ID }}
 subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

 - name: Create Azure Cognitive Search (Free tier)
 env:
 AZURE_RESOURCE_GROUP: ${{ github.event.inputs.resourceGroup }}
 AZURE_LOCATION: ${{ github.event.inputs.location }}
 AZURE_SEARCH_NAME: ${{ github.event.inputs.searchServiceName }}
 run: |
 # Free tier supports a single small index; one free service per subscription
 az search service create \
 --name "$AZURE_SEARCH_NAME" \
 --resource-group "$AZURE_RESOURCE_GROUP" \
 --sku free \
 --location "$AZURE_LOCATION"
